name: unvanquished-alpo
base: core24
version: '0.55.5'
summary: Real-time strategy game where aliens and humans fight for their survival
description: |
  Unvanquished is a free, open-source first-person strategy game shooter, pitting technologically advanced human soldiers against hordes of highly adaptable aliens. Players can choose from either team, providing for an entirely different experience on both sides, as humans focus on long-range firepower while aliens rely instead on quick movement and stealth. The goal of each match is to destroy the enemy base, preventing members of the opposing team from spawning. Upgrades for both teams are earned by a combination of individual performance and team map control, unlocking access to more powerful weapons and equipment for the humans, and larger, more ferocious forms for the aliens.

grade: stable
confinement: strict

icon: snap/gui/unvanquished.png
website: https://unvanquished.net/
contact: https://github.com/alponaut/unvanquished-snap-unofficial/issues
issues: https://github.com/alponaut/unvanquished-snap-unofficial/issues
source-code: https://github.com/alponaut/unvanquished-snap-unofficial/

platforms:
  amd64:
    build-on: [amd64]
    build-for: [amd64]
  arm64:
    build-on: [arm64]
    build-for: [arm64]
  armhf:
    build-on: [armhf]
    build-for: [armhf]

apps:
  unvanquished:
    extensions: [gnome]
    command: unvanquished/daemon
    plugs:
      - network
      - network-bind
      - audio-playback
      - joystick
      - shmem

plugs:
  shmem:
    interface: shared-memory
    private: true

parts:
  unvanquished:
    plugin: nil
    source: https://github.com/Unvanquished/Unvanquished/releases/download/v${SNAPCRAFT_PROJECT_VERSION}/unvanquished_${SNAPCRAFT_PROJECT_VERSION}.zip
    source-type: zip
    override-build: |
      mkdir -p $CRAFT_PART_INSTALL/unvanquished
      mkdir -p $CRAFT_PART_INSTALL/unvanquished/pkg
      
      cd $CRAFT_PART_SRC
      cd unvanquished_${SNAPCRAFT_PROJECT_VERSION}
      unzip linux-${CRAFT_ARCH_BUILD_FOR}.zip -d $CRAFT_PART_INSTALL/unvanquished
      cp pkg/* $CRAFT_PART_INSTALL/unvanquished/pkg
    build-packages:
      - unzip
    stage-packages:
      - zlib1g
      - liblua5.3-0
      - libopenal1
      - libopusfile0
  
  gpu-2404:
    after: [unvanquished]
    source: https://github.com/canonical/gpu-snap.git
    plugin: dump
    override-prime: |
      craftctl default
      ${CRAFT_PART_SRC}/bin/gpu-2404-cleanup mesa-2404
      # Workaround for https://bugs.launchpad.net/snapd/+bug/2055273
      mkdir -p "${CRAFT_PRIME}/gpu-2404"
    prime:
    - bin/gpu-2404-wrapper
